<p-table [value]="sdRequests$ | async" [lazy]="true" (onLazyLoad)="loadSdRequests($event)" [rowHover]="true" dataKey="id"
  [paginator]="true" [rows]="maxSize$ | async" [rowsPerPageOptions]="[10,25,50]" [totalRecords]="totalCount$ | async"
  [showCurrentPageReport]="true" currentPageReportTemplate="Показано {first}-{last} из {totalRecords} заявок" [loading]="loading$ | async">
  <ng-template pTemplate="header">
    <tr>
      <th>No.</th>
      <th>Дата подачи</th>
      <th>Дедлайн</th>
      <th>Статус</th>
      <th>Вид услуги</th>
      <th>Вид заявки</th>
      <th>Подробности</th>
      <th>Приоритет</th>
      <th>Исполнители</th>
      <th>Дата закрытия</th>
      <th></th>
    </tr>
  </ng-template>
  <ng-template pTemplate="body" let-req let-expanded="expanded">
    <tr>
      <td>{{ req.id }}</td>
      <td>{{ req.runtime.created_at | datetime }}</td>
      <td>{{ req.runtime.finished_at_plan | datetime }}</td>
      <td>
        <span [class]="'sd-request-badge status-' + status(req.status).badge">{{ status(req.status).title }}</span>
      </td>
      <td>{{ req.service_name }}</td>
      <td>{{ req.ticket_name }}</td>
      <td>{{ req.description }}</td>
      <td>{{ priority(req.priority).title }}</td>
      <td>
        <div *ngFor="let worker of workers(req); trackBy:trackByWorker">{{ worker.user?.fio | fioMiddleName }}</div>
      </td>
      <td>{{ req.runtime.finished_at | datetime }}</td>
      <td>
        <button type="button" pButton pRipple [pRowToggler]="req" class="p-button-text p-button-rounded p-button-plain" [icon]="expanded ? 'pi pi-chevron-down' : 'pi pi-chevron-left'"></button>
      </td>
    </tr>
  </ng-template>
  <ng-template pTemplate="rowexpansion" let-req>
    <tr>
      <td colspan=11>
        <div class="p-p-2">
          <lib-sd-request-history-overview [sdRequest]="req"></lib-sd-request-history-overview>
        </div>
      </td>
    </tr>
  </ng-template>
</p-table>
