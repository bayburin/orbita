<div class="card col-6">
  <form [formGroup]="form">
    <div class="field grid mb-5">
      <label for="employee" class="col-2">Работник</label>
      <div class="col-10">
        <p-selectButton
          class="block mb-3"
          [options]="employeeFilters"
          [formControl]="employeeFilterKey"
          optionLabel="title"
        ></p-selectButton>

        <p-autoComplete
          #employeeAutoComplete
          id="employee"
          class="block mb-3"
          [formControl]="employee"
          [suggestions]="employees$ | async"
          [showEmptyMessage]="true"
          [autofocus]="true"
          [minLength]="3"
          [virtualScroll]="true"
          scrollHeight="300px"
          [itemSize]="40"
          field="fullName"
          [placeholder]="employeeFilterKey.value?.inputPlaceHolder"
          appendTo="body"
          styleClass="w-full"
          inputStyleClass="w-full"
          (completeMethod)="search($event)"
          (onFocus)="employeeAutoComplete.show()"
          (onClear)="clearEmployee()"
          (onSelect)="selectEmployee()"
        >
          <ng-template let-employee pTemplate="item">
            <p-chip [label]="employee.departmentForAccounting"></p-chip>
            <span class="ml-3">{{ employee.fullName }}</span>
          </ng-template>
        </p-autoComplete>

        <div class="field-checkbox">
          <p-checkbox formControlName="employeeManuallyFlag" binary="true" inputId="employeeManuallyFlag"></p-checkbox>
          <label for="employeeManuallyFlag">Ввести данные о работнике вручную</label>
        </div>

        <div *ngIf="form.get('employeeManuallyFlag').value" formGroupName="source_snapshot">
          <div class="formgrid grid">
            <div class="field col">
              <label for="tn">Таб. номер</label>
              <input type="text" id="tn" formControlName="tn" class="inputfield w-full" pInputText />
            </div>
            <div class="field col">
              <label for="fullname">ФИО</label>
              <input type="text" id="fullname" formControlName="fio" class="inputfield w-full" pInputText />
            </div>
            <div class="field col">
              <label for="dept">Отдел</label>
              <input type="text" id="dept" formControlName="dept" class="inputfield w-full" pInputText />
            </div>
          </div>
          <div class="formgrid grid" formGroupName="user_attrs">
            <div class="field col">
              <label for="email">Электронная почта</label>
              <input type="text" id="email" formControlName="email" class="inputfield w-full" pInputText />
            </div>
            <div class="field col">
              <label for="phone">Телефон</label>
              <input type="text" id="phone" formControlName="phone" class="inputfield w-full" pInputText />
            </div>
          </div>
        </div>
      </div>
    </div>

    <p-divider type="dashed"></p-divider>

    <div class="field grid my-5">
      <label for="sd_ticket" class="col-2">Услуга</label>
      <div class="col-10">
        <p-autoComplete
          #ticketAppautoComplete
          id="ticket"
          class="block mb-3"
          [formControl]="ticket"
          [suggestions]="tickets$ | async"
          [showEmptyMessage]="true"
          [autofocus]="true"
          [virtualScroll]="true"
          scrollHeight="300px"
          [itemSize]="30"
          field="name"
          placeholder="Выберите услугу..."
          appendTo="body"
          styleClass="w-full"
          inputStyleClass="w-full"
          (completeMethod)="search($event)"
          (onFocus)="ticketAppautoComplete.show()"
          (onClear)="clearTicket()"
          (onSelect)="selectTicket()"
        ></p-autoComplete>

        <div class="field-checkbox">
          <p-checkbox formControlName="noTicketFlag" binary="true" inputId="noTicketFlag"></p-checkbox>
          <label for="noTicketFlag">Услуга не найдена</label>
        </div>
      </div>
    </div>

    <div class="field grid mb-5">
      <label for="description" class="col-2">Описание</label>
      <div class="col-10">
        <textarea
          id="description"
          formControlName="description"
          rows="10"
          placeholder="Введите описание заявки..."
          pInputTextarea
          class="w-full"
        ></textarea>
      </div>
    </div>

    <p-divider type="dashed"></p-divider>

    <div class="field grid my-5">
      <label for="files" class="col-2">Файлы</label>
      <div class="col-10">
        <lib-attachments-form [attachmentsForm]="newAttachmentsForm"></lib-attachments-form>
      </div>
    </div>
  </form>
</div>
